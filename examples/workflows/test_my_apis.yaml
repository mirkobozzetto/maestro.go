name: test_my_apis
version: "1.0"
timeout: 30s

services:
  fastapi:
    type: http
    endpoint: "http://localhost:8000"
    timeout: 5s
    retry:
      attempts: 3
      backoff: exponential

  nextjs:
    type: http
    endpoint: "http://localhost:3000"
    timeout: 5s

steps:
  # Test FastAPI
  - id: create_user_fastapi
    service: fastapi
    method: CreateUser
    input:
      email: "{{ .input.email }}"
      name: "{{ .input.name }}"
    output: user

  # Test Next.js API Route
  - id: send_notification_nextjs
    service: nextjs
    method: SendNotification
    input:
      user_id: "{{ .user.id }}"
      message: "Welcome {{ .input.name }}!"
    output: notification

  # Parallel calls to both
  - parallel:
      - id: get_user_profile
        service: fastapi
        method: GetUserProfile
        input:
          user_id: "{{ .user.id }}"
        output: profile
        
      - id: get_user_settings
        service: nextjs
        method: GetUserSettings
        input:
          user_id: "{{ .user.id }}"
        output: settings

output:
  user_id: "{{ .user.id }}"
  profile: "{{ .profile }}"
  settings: "{{ .settings }}"
  status: "completed"